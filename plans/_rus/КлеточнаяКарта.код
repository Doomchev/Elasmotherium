шаблоны Клеточн**Карт*, Тип*НомераКлетки;

импортирован Рисyемый;

класс КлеточнаяКарта<ЛюбойЦелый ТипНомераКлетки> расширяет Рисyемого {
	шаблоны размер*Ряда, размер*Столбца, ширин*Клетки, высот*Клетки, изображени*, клет[о]к*, максимальн***Номер*Клетки, номер*Клетки;

  Целые размерРяда, размерСтолбца, ширинаКлетки, высотаКлетки, максимальныйНомерКлетки;
	Массив<ТипаНомераКлетки> клетки;
  Массив<Изображений> изображения;
	долженБыть(клеток.размер == размерyРяда * размерСтолбца);
	долженБыть(изображений.размер >= максимальногоНомераКафеля);

  создать(поле размерРяда, поле размерСтолбца, поле изображения, ТипаНомераКлетки номерКлетки = 0) {
    Целое количествоКлеток = изображений.размер;
    ширинаКлетки = изображения[0].ширина;
    высотаКлетки = изображения[0].высота;
    клетки = Массив<ТипаНомераКлетки>(размерРяда * размерСтолбца, номерКлетки);
  }
	
	Целая ширина -> ширинаКлетки * размерРяда;
	Целая высота -> высотаКлетки * размерСтолбца;
  
  рисовать(Целое x = 0, Целое y = 0) {
    for(Целый ряд от 0 до размераСтолбца)
			for(Целый столбец от 0 до размераРяда)
				изображение[клетка[столбец + ряд * размерРяда]].рисовать(x + столбец * ширинаКлетки, y + ряд * высотаКлетки);
  }
  
  ТипНомераКлетки поИндексy(Целый столбец, Целый ряд) -> клетка[столбец + ряд * размерРяда];
	
  поИндексy(Целый столбец, Целый ряд, ТипаНомераКлетки номерКлетки) клетка[столбец + ряд * размерРяда] = номерyКлетки;
  
  Целое xКлетки(Целое xЭкрана) -> xЭкрана / ширинаКлетки;
  Целое yКлетки(Целое yЭкрана) -> yЭкрана / высотаКлетки;
}